<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.plcopen.org/xml/tc6_0200">
  <fileHeader companyName="Beckhoff Automation GmbH" productName="TwinCAT PLC Control" productVersion="3.5.13.21" creationDateTime="2024-02-17T22:43:37.076425" />
  <contentHeader name="PLC" modificationDateTime="2024-02-17T22:43:37.076425">
    <coordinateInfo>
      <fbd>
        <scaling x="1" y="1" />
      </fbd>
      <ld>
        <scaling x="1" y="1" />
      </ld>
      <sfc>
        <scaling x="1" y="1" />
      </sfc>
    </coordinateInfo>
    <addData>
      <data name="http://www.3s-software.com/plcopenxml/projectinformation" handleUnknown="implementation">
        <ProjectInformation />
      </data>
    </addData>
  </contentHeader>
  <types>
    <dataTypes />
    <pous>
      <pou name="MAIN" pouType="program">
        <interface>
          <localVars>
            <variable name="cylinders">
              <type>
                <array>
                  <dimension lower="0" upper="G.numAxis" />
                  <baseType>
                    <derived name="CylResource" />
                  </baseType>
                </array>
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> resources</xhtml>
              </documentation>
            </variable>
            <variable name="PBs">
              <type>
                <array>
                  <dimension lower="0" upper="G.numAxis" />
                  <baseType>
                    <derived name="PBResource" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="LPs">
              <type>
                <array>
                  <dimension lower="0" upper="G.numAxis" />
                  <baseType>
                    <derived name="LPResource" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="firstScan">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="TRUE" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> system</xhtml>
              </documentation>
            </variable>
            <variable name="permConfigCyl">
              <type>
                <array>
                  <dimension lower="0" upper="G.numAxis" />
                  <baseType>
                    <derived name="CylConfig" />
                  </baseType>
                </array>
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml"> 動作設定</xhtml>
              </documentation>
            </variable>
            <variable name="permConfigPB">
              <type>
                <array>
                  <dimension lower="0" upper="G.numAxis" />
                  <baseType>
                    <derived name="PBConfig" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="permConfigLP">
              <type>
                <array>
                  <dimension lower="0" upper="G.numAxis" />
                  <baseType>
                    <derived name="LPConfig" />
                  </baseType>
                </array>
              </type>
            </variable>
            <variable name="i">
              <type>
                <LINT />
              </type>
            </variable>
            <variable name="unmatchConfig">
              <type>
                <BOOL />
              </type>
              <initialValue>
                <simpleValue value="FALSE" />
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">Unit();


// 動作設定不一致を調べる
unmatchConfig := FALSE;
FOR i := 0 TO G.numAxis DO
	IF permConfigCyl[i].cylinderErrorTime &lt;&gt; cylinders[i].config.cylinderErrorTime THEN
		unmatchConfig := TRUE;
	END_IF
	IF permConfigCyl[i].operateDelayTime &lt;&gt; cylinders[i].config.operateDelayTime THEN
		unmatchConfig := TRUE;
	END_IF
	IF permConfigCyl[i].sensorDelayTime &lt;&gt; cylinders[i].config.sensorDelayTime THEN
		unmatchConfig := TRUE;
	END_IF
	IF permConfigPB[i].pushDelayTime &lt;&gt; PBs[i].config.pushDelayTime THEN
		unmatchConfig := TRUE;
	END_IF
	IF permConfigLP[i].invert &lt;&gt; LPs[i].config.invert THEN
		unmatchConfig := TRUE;
	END_IF
END_FOR


// 起動後初回に動作設定を元に戻す
IF firstScan THEN
	FOR i := 0 TO G.numAxis DO
		cylinders[i].config := permConfigCyl[i];
		PBs[i].config := permConfigPB[i];
		LPs[i].config := permConfigLP[i];
	END_FOR
END_IF


firstScan := FALSE;</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/interfaceasplaintext" handleUnknown="implementation">
            <InterfaceAsPlainText>
              <xhtml xmlns="http://www.w3.org/1999/xhtml">PROGRAM MAIN
VAR
	// resources
	cylinders: ARRAY[0..G.numAxis] OF CylResource;
	PBs: ARRAY[0..G.numAxis] OF PBResource;
	LPs: ARRAY[0..G.numAxis] OF LPResource;
	
	// system
	firstScan: BOOL := TRUE;
	
	// 動作設定
	permConfigCyl: ARRAY[0..G.numAxis] OF CylConfig;
	permConfigPB: ARRAY[0..G.numAxis] OF PBConfig;
	permConfigLP: ARRAY[0..G.numAxis] OF LPConfig;
	i: LINT;
	unmatchConfig: BOOL := FALSE;
END_VAR
</xhtml>
            </InterfaceAsPlainText>
          </data>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>da0fac0e-5c5e-4258-bd78-50792652aa25</ObjectId>
          </data>
        </addData>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations />
  </instances>
  <addData>
    <data name="http://www.3s-software.com/plcopenxml/projectstructure" handleUnknown="discard">
      <ProjectStructure>
        <Object Name="MAIN" ObjectId="da0fac0e-5c5e-4258-bd78-50792652aa25" />
      </ProjectStructure>
    </data>
  </addData>
</project>